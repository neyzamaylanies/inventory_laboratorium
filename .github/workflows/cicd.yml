# Workflow ini akan berjalan otomatis ketika ada push ke branch main atau pull request.
name: CI/CD Build & Test (Spring Boot Maven)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:

  build-and-test:
    name: Build dan Test Aplikasi
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout kode repository
      - name: Checkout Code
        uses: actions/checkout@v4

      # Step 2: Siapkan lingkungan Java (JDK 25)
      - name: Set up JDK 25
        uses: actions/setup-java@v4
        with:
          java-version: '25'
          distribution: 'temurin'
          cache: 'maven'

      # üìå Step 3 BARU: Berikan Izin Eksekusi pada mvnw
      - name: Set execute permission for mvnw
        # Perintah ini menambahkan izin eksekusi (+x) pada file mvnw
        run: chmod +x mvnw

      # Step 4 (Sebelumnya Step 3): Build proyek, jalankan Test, dan buat file JAR
      - name: Build, Test, and Package with Maven
        # Sekarang ./mvnw bisa dieksekusi
        run: ./mvnw clean install

      # Step 5: Simpan file JAR sebagai Artifact
      - name: Upload JAR Artifact
        uses: actions/upload-artifact@v4
        with:
          name: inventory-laboratorium-jar
          path: target/*.jar 

      # Step 6: Notifikasi Status
      - name: Notify Build Status
        if: always()
        run: |
          if [ ${{ job.status }} == 'success' ]; then
            echo "‚úÖ Build dan Test berhasil! JAR sudah di-generate dan disimpan sebagai artifact."
          else
            echo "‚ùå Build atau Test gagal. Cek log error di atas."
          fi